# Sycamore Query Evaluation tool

This tool can be used to evaluate the query planning and answering capabilities
of Sycamore Query against a given dataset and set of queries. This is a wrapper
around the `sycamore.query.client.SycamoreQueryClient` class that reads a
configuration from an input YAML file, and writes results to an output YAML file.

## Input file format

The input file format is YAML and is defined by the `queryeval.types.QueryEvalInputFile`
class. The following is a minimal example of the input file format:

```yaml
# General configuration options. Each of these can be specified
# on the command line as well.
config:
    # The OpenSearch index to use.
    index: const_ntsb

# The list of queries to run. Each has a query and an expected
# result, which can be either a string, or a list of dictionaries,
# with each element of the list representing a Sycamore Document
# expected to be returned by the query.
queries:
    - query: "How many incidents were there in 2023?"
      expected: "There were 10 incidents in 2023."
    - query: "How many incidents occurred in bad weather?"
      expected: "7 incidents occurred in bad weather."
```

Examples of input files can be found in the `data/` directory.

## Output file format

The output file format is YAML and is defined by the `queryeval.types.QueryEvalResultsFile`
type. Depending on the configuration options used when run, the output file may
contain one or more of the following:
    * Query plans generated by the Sycamore Query Planner.
    * Query results produced by running these query plans.
    * Accuracy and quality metrics calculated from the query results.

The idea is that each of these stages of the evaluation can be run independently, and
the results from previous stages can be used as input to the next stage.

## Running the tool

First, run `poetry install` in this directory to install all dependencies.

You can get a full list of options by running:

```bash
$ poetry run python queryeval/main.py --help
```